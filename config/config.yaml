# Minimal inference-only configuration
# Only parameters actually read/used by inference.py and DefaultPredictor

MODEL:
  # Used by build_model() - architecture definition
  META_ARCHITECTURE: GeneralizedRCNN
  BACKBONE:
    NAME: build_resnet_fpn_backbone
  RESNETS:
    DEPTH: 50
    OUT_FEATURES: [res2, res3, res4, res5]
  FPN:
    IN_FEATURES: [res2, res3, res4, res5]
    OUT_CHANNELS: 256
  ANCHOR_GENERATOR:
    SIZES: [[32], [64], [128], [256], [512]]
    ASPECT_RATIOS: [[0.5, 1.0, 2.0]]
  PROPOSAL_GENERATOR:
    NAME: RPN
  RPN:
    IN_FEATURES: [p2, p3, p4, p5, p6]
    PRE_NMS_TOPK_TEST: 1000
    POST_NMS_TOPK_TEST: 1000
  ROI_HEADS:
    NAME: StandardROIHeads
    IN_FEATURES: [p2, p3, p4, p5]
    NUM_CLASSES: 1  # Overridden by --num-classes in inference.py
    SCORE_THRESH_TEST: 0.05  # Overridden by --confidence-threshold in inference.py
    NMS_THRESH_TEST: 0.5
  ROI_BOX_HEAD:
    NAME: FastRCNNConvFCHead
    POOLER_RESOLUTION: 7
    POOLER_TYPE: ROIAlignV2
  ROI_MASK_HEAD:
    NAME: MaskRCNNConvUpsampleHead
    POOLER_RESOLUTION: 14
    POOLER_TYPE: ROIAlignV2
  MASK_ON: true
  # Used by DefaultPredictor for image normalization
  PIXEL_MEAN: [103.53, 116.28, 123.675]
  PIXEL_STD: [1.0, 1.0, 1.0]
  # Set via --weights argument in inference.py
  WEIGHTS: ""

# Used by DefaultPredictor (lines 322-326 in defaults.py)
INPUT:
  FORMAT: BGR  # Used by DefaultPredictor.__call__
  MASK_FORMAT: bitmask  # Set in inference.py line 45, but can be in config
  MIN_SIZE_TEST: 800  # Used by DefaultPredictor for ResizeShortestEdge
  MAX_SIZE_TEST: 1333  # Used by DefaultPredictor for ResizeShortestEdge

# Used by DefaultPredictor (line 316-317 in defaults.py) and inference.py (line 338)
DATASETS:
  TEST: []  # Set dynamically in inference.py line 67

# Required by Detectron2 config system
VERSION: 2
